<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guides/av1_for_dummies">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">AV1 Encoding for Dummies | Codec Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://av1-wiki.github.io/av1-wiki.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://av1-wiki.github.io/av1-wiki.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://av1-wiki.github.io/av1-wiki.github.io/docs/guides/av1_for_dummies"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="AV1 Encoding for Dummies | Codec Wiki"><meta data-rh="true" name="description" content="-&gt; This guide will show you how to encode in AV1 the right way. Yes, you using standalone `libaom, libsvtav1, and librav1e from FFmpeg or even piping yuv4mpeg` into mainline Aomenc are all wrong. &lt;-"><meta data-rh="true" property="og:description" content="-&gt; This guide will show you how to encode in AV1 the right way. Yes, you using standalone `libaom, libsvtav1, and librav1e from FFmpeg or even piping yuv4mpeg` into mainline Aomenc are all wrong. &lt;-"><link data-rh="true" rel="icon" href="/av1-wiki.github.io/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://av1-wiki.github.io/av1-wiki.github.io/docs/guides/av1_for_dummies"><link data-rh="true" rel="alternate" href="https://av1-wiki.github.io/av1-wiki.github.io/docs/guides/av1_for_dummies" hreflang="en"><link data-rh="true" rel="alternate" href="https://av1-wiki.github.io/av1-wiki.github.io/docs/guides/av1_for_dummies" hreflang="x-default"><link rel="stylesheet" href="/av1-wiki.github.io/assets/css/styles.fa548e7b.css">
<link rel="preload" href="/av1-wiki.github.io/assets/js/runtime~main.5ff2ee5c.js" as="script">
<link rel="preload" href="/av1-wiki.github.io/assets/js/main.fdbf91cc.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/av1-wiki.github.io/"><div class="navbar__logo"><img src="/av1-wiki.github.io/img/favicon.svg" alt="AV1 &quot;Stonks&quot; logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/av1-wiki.github.io/img/favicon.svg" alt="AV1 &quot;Stonks&quot; logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Codec Wiki</b></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/av1-wiki.github.io/docs/prequisites">üó≥Ô∏è Prequisites</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/av1-wiki.github.io/docs/introduction/prologue">üí° Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/av1-wiki.github.io/docs/audio/AAC">üîä Audio</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/av1-wiki.github.io/docs/video/h264">üìπÔ∏è Video</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/av1-wiki.github.io/docs/images/jpeg">üèûÔ∏è Images</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/av1-wiki.github.io/docs/encoders/x264">üíæ Encoders</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/av1-wiki.github.io/docs/subtitles/SRT">üí¨ Subtitles</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/av1-wiki.github.io/docs/filtering/intro">üéûÔ∏è Filtering</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/av1-wiki.github.io/docs/utilities/Aviator">üõ†Ô∏è Utilities</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/av1-wiki.github.io/docs/metrics/VMAF">üëÅÔ∏è Metrics</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/av1-wiki.github.io/docs/guides/av1_for_dummies">üìù Gudies</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/av1-wiki.github.io/docs/guides/av1_for_dummies">AV1 Encoding for Dummies</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/av1-wiki.github.io/docs/video-players">‚ñ∂Ô∏è Video Players</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/av1-wiki.github.io/docs/resources">üóÉÔ∏è Resources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/av1-wiki.github.io/docs/contribution-guide">‚úíÔ∏è Contribution Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/av1-wiki.github.io/docs/FAQ">‚ùì FAQ</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/av1-wiki.github.io/docs/privacy-policy">üîè Privacy Policy</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/av1-wiki.github.io/docs/terms-of-use">ü§ù Terms of Use</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/av1-wiki.github.io/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">üìù Gudies</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">AV1 Encoding for Dummies</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>AV1 Encoding for Dummies</h1><h1>AV1 Encoding Guide for Dummies</h1><p>-&gt; This guide will show you how to encode in AV1 <em>the right way</em>. Yes, you using standalone <code>libaom</code>, <code>libsvtav1</code>, and <code>librav1e</code> from FFmpeg or even piping <code>yuv4mpeg</code> into <strong>mainline</strong> Aomenc are all wrong. &lt;-</p><p><img loading="lazy" src="https://autumn.revolt.chat/attachments/Xe9o7rg3DayS0OZ4Xi9R-CO_e2gidBsI3MNOUhoy3y/compare-guide.webp" alt="Compare" class="img_ev3q"></p><h1>Getting Started</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="microsoft-windows">Microsoft Windows<a href="#microsoft-windows" class="hash-link" aria-label="Direct link to Microsoft Windows" title="Direct link to Microsoft Windows">‚Äã</a></h3><p><strong>The Easy Way:</strong></p><ol><li>Install <a href="https://github.com/n00mkrad/nmkoder" target="_blank" rel="noopener noreferrer">Nmkoder</a> which is a GUI front-end to av1an with all dependencies installed</li><li>You&#x27;re done, you can skip to the next part</li></ol><div class="theme-admonition theme-admonition-warning alert alert--danger admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Outdated Software</div><div class="admonitionContent_S0QG"><p>Since Nmkoder already ships everything by default and its last release was 29th March 2022. You need to manually update EVERYTHING (av1an.exe, aomenc.exe, etc) to get performance optimizations, better speeds, and more settings. Missing out on updates will result in your encodes being sub-optimal. You can use the instructions below to help you update.</p></div></div><p><strong>The (not very) Hard Way (Recommended):</strong></p><ol><li><p>Install <strong>Python 3.10.x, this will change so consult from the</strong> <a href="http://www.vapoursynth.com/doc/installation.html" target="_blank" rel="noopener noreferrer">Vapoursynth website</a> <strong>if you&#x27;re reading this from the future</strong> from <a href="https://www.python.org/downloads/windows/" target="_blank" rel="noopener noreferrer">here</a> and select &quot;Windows Installer 64-bit&quot;. Upon installation check the tick for adding Python to PATH like so
<img loading="lazy" src="https://miro.medium.com/max/1344/0*7nOyowsPsGI19pZT.png" alt="Python" class="img_ev3q"></p></li><li><p>Download and install Vapoursynth from <a href="https://github.com/vapoursynth/vapoursynth/releases" target="_blank" rel="noopener noreferrer">here</a> and select &quot;VapourSynth64-RXX.exe&quot;</p></li><li><p>Open Command Prompt/Terminal/whatever and do <code>vsrepo.py install lsmas ffms2</code> to install some plugins for Av1an to work</p></li><li><p>Download MKVToolNix from <a href="https://mkvtoolnix.download/downloads.html#windows" target="_blank" rel="noopener noreferrer">here</a>, select &quot;mkvtoolnix-64bit-XX.X.X-setup.exe&quot;, and install</p></li><li><p>Download Av1an from <a href="https://github.com/master-of-zen/Av1an/releases" target="_blank" rel="noopener noreferrer">here</a> (SELECT LATEST AND CLICK THE &quot;ASSETS&quot; DROPDOWN)</p></li><li><p>Download <strong>shared libraries</strong> FFmpeg from <a href="https://www.gyan.dev/ffmpeg/builds" target="_blank" rel="noopener noreferrer">gyan.dev</a></p></li><li><p>Download a pre-built fork of Aomenc (<a href="https://github.com/Clybius/aom-av1-lavish/tree/Endless_Merging" target="_blank" rel="noopener noreferrer">aom-av1-lavish</a>) which has neat stuff such as sane defaults, new tunes, optimizations, etc. Which can be downloaded <a href="https://cdn.discordapp.com/attachments/1042536514783023124/1121801826921103420/aom-lavish-opmox-patch.7z" target="_blank" rel="noopener noreferrer">here</a></p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Updating and compiling</div><div class="admonitionContent_S0QG"><p>Join the <a href="https://discord.gg/vpREHAvYvh" target="_blank" rel="noopener noreferrer">AV1 Discord server</a> and head to #community-builds for updated versions, you can opt to compile it yourself with those custom (Butteraugli, VMAF) tunes but its a huge PITA on Windows.</p></div></div></li><li><p>Move Av1an, FFmpeg <strong>(Including the DLLs)</strong>, and Aomenc to somewhere preferable eg <code>C:\Encoding</code></p></li><li><p>Add the folder <strong>AND MKVTOOLNIX INSTALLATION FOLDER</strong> to the <a href="https://www.maketecheasier.com/what-is-the-windows-path/" target="_blank" rel="noopener noreferrer">Windows PATH environment</a></p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="macos">macOS<a href="#macos" class="hash-link" aria-label="Direct link to macOS" title="Direct link to macOS">‚Äã</a></h3><p><em>written by gb82</em></p><p>macOS is very similar to Linux, although there aren&#x27;t any GUI tools for AV1 encoding that I can comfortably recommend.</p><p><strong>Homebrew + Macports for Av1an + rav1e:</strong>
<em>Note that some commands may have to be run with <code>sudo</code>, which I won&#x27;t explicitly include for security reasons.</em></p><p>Installing the Homebrew package manager is a well documented process at this point:</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/bin/bash -c &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As is installing MacPorts. Install the relevent <code>.pkg</code> for your macOS version from the MacPorts Project website:
<a href="https://www.macports.org/install.php" target="_blank" rel="noopener noreferrer">www.macports.org/install.php</a></p><p>Now, you can run the following commands:</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">brew update &amp;&amp; brew upgrade</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">brew install rav1e aom mkvtoolnix ffmpeg</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># Usually you must run MacPorts commands for package installations as root</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">port upgrade outdated</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">port install av1an</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is the easiest way to get everything set up &amp; working to produce AV1 video with <code>rav1e</code> or mainline <code>aomenc</code> &amp; Av1an. You can check that things are installed by running the following commands &amp; parsing their output:</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">% av1an --version</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">av1an 0.4.1-unstable (rev e10880d) (Release)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* Compiler</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  rustc 1.70.0 (LLVM 16.0)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* Target Triple</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  aarch64-apple-darwin</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* Date Info</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  Commit Date:  2023-06-25</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">* VapourSynth Plugins</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  systems.innocent.lsmas : Not found</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  com.vapoursynth.ffms2  : Not found</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">% rav1e --version | grep &quot;release&quot; -C 1      </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rav1e 0.6.6 () (release)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">rustc 1.69.0 (84c898d65 2023-04-16) (built from a source tarball) aarch64-apple-darwin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">% aomenc --help | grep &quot;AOMedia&quot; -C 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Included encoders:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    av1    - AOMedia Project AV1 Encoder 3.6.1 (default)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Use --codec to switch to a non-default encoder.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice <code>systems.innocent.lsmas : Not found</code> in the Av1an output. This means you won&#x27;t be able to use the lsmash chunking method through vapoursynth &amp; may instead have to rely on hybrid chunking, through <code>-m hybrid</code>. This is slower &amp; takes up disk space while encoding, but still works. A sample Av1an command with this basic installation may look like this:</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">av1an -i &quot;input&quot; -y --resume --verbose --split-method av-scenechange -m hybrid -c mkvmerge -e rav1e --force -v &quot; --tiles 8 -s 4 --quantizer 80 --no-scene-detection&quot; --photon-noise 7 --chroma-noise --pix-format yuv420p10le -w 8 -o &quot;output.mkv&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Building From Source</strong></p><p>If you want lsmash support, aom-av1-lavish instead of mainline, or anything else that isn&#x27;t covered by the more basic installation, you&#x27;ll have to compile from source. Things are very similar to Linux, with a few oddities:</p><ul><li>macOS sometimes doesn&#x27;t have a <code>/usr/local/bin</code> by default. You can fix this by doing <code>mkdir /usr/local/bin</code>.</li><li>Homebrew installs <em>everything</em> in its own directory structure. If you&#x27;re building things from source that rely on libraries from vapoursynth, zimg, lsmash, etc, make sure to copy them from <code>/opt/homebrew/lib</code> to <code>/usr/local/lib</code>. Finding them is a matter of <code>ls | grep &quot;keyword&quot;</code> &amp; copying what looks reasonable to be associated with the tool you&#x27;re using.</li><li>Building most things from source will have instructions for <!-- -->*<!-- -->nix which work for both macOS &amp; Linux. Even if it says Linux, there&#x27;s a good chance it&#x27;ll work on macOS as well, &amp; it is always worth trying Linux build instructions on Mac. I won&#x27;t be going through building every encoding tool &amp; dependency from source, as it is generally much more intuitive than Windows, but building Av1an is worth detailing here just as an example.</li></ul><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">brew install git rust nasm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/master-of-zen/Av1an</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd Av1an</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUSTFLAGS=&quot;-C target-cpu=native&quot; cargo build --release</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd .. &amp;&amp; cd target/release</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cp av1an /usr/local/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>More Difficult: Building aom-av1-lavish from Source</strong></p><p>If you want to make the most out of your hardware &amp; eke out every last drop of quality, it may be worth building aom-av1-lavish from source. The first step is to clone it from the Endless Merging branch:</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">git clone https://github.com/Clybius/aom-av1-lavish -b Endless_Merging</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cd aom-av1-lavish</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, you need to make some manual changes to the source code until Clybius merges <a href="https://github.com/Clybius/aom-av1-lavish/pull/1/files" target="_blank" rel="noopener noreferrer">this commit</a>.</p><ul><li>Add the line <code>#include &quot;aq_variance.h&quot;</code> at line 19 in <code>av1/encoder/encodeframe_utils.c</code></li><li>Comment out line 2546 in <code>av1/encoder/speed_features.c</code>. This line is <code>const int qindex_thresh_cdef_sf_s1_s3_l2[2] = { 92, 48 };</code> &amp; becomes <code>// const int qindex_thresh_cdef_sf_s1_s3_l2[2] = { 92, 48 };</code>.</li></ul><p>Now you can continue to build according to the Linux instructions below. Obviously you&#x27;ll need cmake, which you can install with homebrew along with any other tools you may need. While still in the <code>aom-av1-lavish</code> directory:</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">mkdir -p aom_build &amp;&amp; cd aom_build</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cmake .. -DBUILD_SHARED_LIBS=0 -DENABLE_DOCS=0 -DCONFIG_TUNE_BUTTERAUGLI=0 -DCONFIG_TUNE_VMAF=0 -DCONFIG_AV1_DECODER=0 -DENABLE_TESTS=0 -DCMAKE_BUILD_TYPE=Release -DCMAKE_CXX_FLAGS=&quot;-flto -O3 -march=native&quot; -DCMAKE_C_FLAGS=&quot;-flto -O3 -march=native -pipe -fno-plt&quot; -DCMAKE_LD_FLAGS=&quot;-flto -O3 -march=native&quot;</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make -j$(nproc)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"># This may need to be run as root:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">make install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now you can run <code>aomenc --help | grep &quot;AOMedia&quot; -C 3</code> to see if lavish installed. If you&#x27;re getting the same output as above, you may need to copy the <code>aomenc</code> executable to <code>/opt/local/bin</code>, <code>/usr/local/bin</code>, &amp; <code>/opt/homebrew/bin</code> if you already installed mainline aomenc. Running the version info command again, the correct output should look something like this:</p><div class="language-zsh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-zsh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">% aomenc --help | grep AOMedia -C 3</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Included encoders:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    av1    - AOMedia Project AV1 Encoder Psy v3.6.0 (default)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        Use --codec to switch to a non-default encoder.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice how it says <code>AOMedia Project AV1 Encoder Psy</code> instead of <code>AOMedia Project AV1 Encoder</code>. You should be all set after this to start using aom-av1-lavish &amp; following the current parameter meta as outlined below.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux">Linux<a href="#linux" class="hash-link" aria-label="Direct link to Linux" title="Direct link to Linux">‚Äã</a></h3><p><strong>The Easy Way:</strong>
Install <a href="https://github.com/gianni-rosato/aviator" target="_blank" rel="noopener noreferrer">Aviator</a>, it is currently only available as a <a href="https://beta.flathub.org/apps/net.natesales.Aviator" target="_blank" rel="noopener noreferrer">Flatpak</a>
or
Install <a href="https://giannirosato.com/blog/post/aviator-1/" target="_blank" rel="noopener noreferrer">rAV1ator</a>, basically same thing but av1an + rav1e
<strong>Keep in mind Aviator ships with SVT-AV1 and rAV1ator with rav1e instead of Aomenc/AOM-AV1, which I will not be covering here</strong></p><p><strong>The compiling route:</strong>
You know what to do, so I&#x27;ll just list the things you&#x27;ll need: <code>Vapoursynth, Av1an, FFmpeg, mkvtoolnix-cli, aom-av1-lavish, Git, Perl, CMake, Ninja, Meson, Nasm, Rust, Highway</code></p><p><strong>Compiling aom-av1-lavish (Basic, recommended for beginners)</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token function" style="color:rgb(80, 250, 123)">git</span><span class="token plain"> clone https://github.com/Clybius/aom-av1-lavish -b Endless_Merging</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> aom-av1-lavish </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">mkdir</span><span class="token plain"> -p aom_build </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(189, 147, 249)">cd</span><span class="token plain"> aom_build</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cmake </span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain"> -DBUILD_SHARED_LIBS</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"> -DENABLE_DOCS</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"> -DCONFIG_TUNE_BUTTERAUGLI</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"> -DCONFIG_TUNE_VMAF</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"> -DCONFIG_AV1_DECODER</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"> -DENABLE_TESTS</span><span class="token operator">=</span><span class="token number">0</span><span class="token plain"> -DCMAKE_BUILD_TYPE</span><span class="token operator">=</span><span class="token plain">Release -DCMAKE_CXX_FLAGS</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;-flto -O3 -march=native&quot;</span><span class="token plain"> -DCMAKE_C_FLAGS</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;-flto -O3 -march=native -pipe -fno-plt&quot;</span><span class="token plain"> -DCMAKE_LD_FLAGS</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;-flto -O3 -march=native&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> -j</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">$(</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">nproc</span><span class="token variable" style="color:rgb(189, 147, 249);font-style:italic">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token function" style="color:rgb(80, 250, 123)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">make</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">install</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Branches</div><div class="admonitionContent_S0QG"><p><code>Endless_Butter</code> used to be bleeding edge but now it&#x27;s been taken over by <code>Endless_Merging</code>, be sure to check the Github page to check which is more updated!</p></div></div><h1>Encoding</h1><p>The moment you&#x27;ve all been waiting for, let&#x27;s just get into it. Here&#x27;s an example <em>recommended</em> parameter as of now (04/02/23):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">av1an -x </span><span class="token number">300</span><span class="token plain"> -i input.mkv -w </span><span class="token number">4</span><span class="token plain"> -e aom -c mkvmerge --resume -m lsmash --photon-noise</span><span class="token operator">=</span><span class="token number">10</span><span class="token plain"> --set-thread-affinity</span><span class="token operator">=</span><span class="token number">2</span><span class="token plain"> --verbose -a </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; -an &quot;</span><span class="token plain"> -f </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; -an &quot;</span><span class="token plain"> -v </span><span class="token string" style="color:rgb(255, 121, 198)">&quot; --bit-depth=10 --cpu-used=4 --end-usage=q --cq-level=24 --threads=2 --tile-columns=0 --tile-rows=0 --lag-in-frames=64 --tune-content=psy --tune=ssim --enable-keyframe-filtering=1 --disable-kf --kf-max-dist=9999 --enable-qm=1 --deltaq-mode=0 --aq-mode=0 --quant-b-adapt=1 --enable-fwd-kf=0 --arnr-strength=1 --sb-size=dynamic --enable-dnl-denoising=0 &quot;</span><span class="token plain"> -o </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;output.mkv&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Parameter Meta</div><div class="admonitionContent_S0QG"><p>Again, it is strongly recommended to join the <a href="https://discord.gg/vpREHAvYvh" target="_blank" rel="noopener noreferrer">AV1 Discord server</a> to get the latest updates on what to use and which to set, as it&#x27;s the only easily reachable place for everything AV1 &amp; encoding tips in general.</p></div></div><p>Now let&#x27;s dissect it one-by-one</p><p><strong>Av1an parameters:</strong></p><ul><li><p><code>-i</code> Input.</p></li><li><p><code>-x 300</code> Sets scene split length to 300 frames, you can increase it for more quality at the tradeoff of video seekability.</p></li><li><p><code>-w 4</code> Specifies the amount of &quot;workers&quot; or amount of encoders working on the video.</p></li><li><p><code>--verbose</code> Sets logging to verbose.</p></li><li><p><code>--resume</code> Resumes the encode even when you haven&#x27;t encoded yet. I strongly recommend leaving this if you resume a lot since you can accidentally delete your whole progress (There&#x27;s no delete confirmation feature.. yet) if you &quot;resumed&quot; without the parameter in place.</p></li><li><p><code>-e aom</code> Specifies we&#x27;re using aomenc encoder which should be the default option.</p></li><li><p><code>-c mkvmerge</code> Specifies we&#x27;re using mkvmerge (MKVToolNix) to concatenate the parts when done, you can specify with ffmpeg if you want to but this is the best method.</p></li><li><p><code>-m lsmash</code> Specifies we&#x27;re using l-smash (Vapoursynth plugin) to split the videos, this is also the best method because ffms2 causes video lag (Tested a year ago, might change now) and other methods just suck (Slow and not worth it, learned the hard way). You can attempt to use ffms2 when inputting VC-1 videos as it is not possible with l-smash (Or convert it to lossless with x264 qp 0).</p></li><li><p><code>-f &quot; -an &quot;</code> <code>-f</code> Stands for ffmpeg parameters, <code>-an</code> is to remove all audio since its better to encode and merge it separately. To crop use <code>-f &quot; -an -vf crop=1920:800 &quot;</code> for example to crop the video to 1920x800.</p></li><li><p><code>-v &quot; &quot;</code> Is where you put the encoder&#x27;s parameters in.</p></li><li><p><code>-a &quot; -an &quot;</code> Audio options, we&#x27;re removing it cause its gonna cause issues.</p></li><li><p><code>--photon-noise=10</code> AV1 grain synthesis, which is a technique where the encoder puts fake grain in so it looks more natural and potentially hiding video artifacts (cause grain is hard to encode and explodes bitrate usage because of their randomness), 5-8 for almost none to little grain, 10-14 for medium, 15+ heavy, 20+ extremely heavy, 30+ for extremely grainy 90s live action films.</p></li><li><p><code>--set-thread-affinity=2</code> Pins the thread to the encoder, aligns with <code>--threads=2</code> in the encoder parameter so set them accordingly.</p></li></ul><p><strong>Aomenc parameters:</strong></p><ul><li><p><code>--bit-depth=10</code> We&#x27;re using 10bit because it makes the video smaller and reduces <a href="https://developer.mozilla.org/en-US/docs/Web/Media/Formats/Video_codecs#contouring" target="_blank" rel="noopener noreferrer">banding</a>.</p></li><li><p><code>--cpu-used=4</code> This is the preset which ranges from 0-9, you can go to 3 if you want more efficiency, 2 if you have a lot of time, 4 is the sweet spot, and 6 if you want speed. Don&#x27;t go above 6 (Worst efficiency) or even 0 (It would take WEEKS to finish).</p></li><li><p><code>--end-usage=q --cq-level=24</code> This specifies that we are going to use a knockoff version of CRF level similar to x264/x265 encoders, in this case CRF 24.</p></li><li><p><code>--tile-columns=0 --tile-rows=0</code> This is the tiles options, where the encoder splits the videos into tiles to encode faster, see the image below (Yellow lines):
<img loading="lazy" src="https://cdn.discordapp.com/attachments/974279294740213762/1058568425313673236/latest.png" alt="Tiling" class="img_ev3q"></p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Tile usage</div><div class="admonitionContent_S0QG"><p>Do NOT use tiles for 1080p and below, use 1 <code>tile-columns</code> at 1440p (2K), 2 <code>tile-columns</code> and 1 <code>tile-rows</code> for 2160p (4K)</p></div></div></li><li><p><code>--lag-in-frames=64</code> Knockoff of x264/x265 <a href="https://en.wikipedia.org/wiki/Group_of_pictures" target="_blank" rel="noopener noreferrer">Group of Pictures</a> (GOP), makes the encoder look into future framesfor better compression decision making, do not go over 64 as it is pretty much useless.</p></li><li><p><code>--aq-mode</code> adaptive quantization mode, 0 is better most of the time</p></li><li><p><code>--tune-content=psy --tune=ssim</code> As the name suggests they are tunes that affect the video output, for the better, and for the worst</p></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Tunes to use</div><div class="admonitionContent_S0QG"><p>Set <code>tune-content</code> to <code>animation</code> if you&#x27;re encoding above <code>cq-level=30</code> A.K.A lower quality, despite it&#x27;s name
Set <code>tune-content</code> to <code>psy</code> for everything else, <strong>do not use if you encode above <code>cq-level=30</code></strong>
For <code>tune</code>, this is a bit tricky. For now, the meta seems to be <code>ssim</code>, but back then it was <code>lavish</code> which is considered THE best tune because it&#x27;s based on <a href="https://github.com/google/butteraugli" target="_blank" rel="noopener noreferrer">butteraugli</a>. Now it&#x27;s fallen behind because its more blurry than <code>ssim</code>, and before that it was <code>butteraugli</code>, and then <code>ipq_vmaf_psy</code>, and finally just <code>ipq</code>.
If you use any of the VMAF tunes, <strong>you need to specify <code>--vmaf-model-path=</code> to where you put it</strong>.</p></div></div><ul><li><p><strong>BONUS:</strong> Use <code>--butteraugli-resize-factor=2</code> if you use any of the butteraugli-based tunes to speed it up without much losses (lavish, butteraugli) and <code>--butteraugli-intensity-target=250</code> to match the content light level.</p></li><li><p><code>--enable-keyframe-filtering=1</code> We&#x27;re setting it to 1 because of compatibility reasons, 2 is more efficient but there are seeking issues and FFmpeg for some reason can&#x27;t input it.</p></li><li><p><code>--sb-size=dynamic</code> Allows the encoder to use 128x128 block partitioning besides 64x64 which gives an efficiency boost, ignore it.</p></li><li><p><code>--deltaq-mode</code> set to 0 bc its better</p></li><li><p><strong>BONUS:</strong> Use <code>--arnr-maxframes</code> to set max reference frames that will be used to filter the encode, higher values would make the video blurrier at high fidelity but look better at lower bitrates.</p></li><li><p><code>--arnr-strength=1</code> Controls how strong the filtering will be, 1 is good for 3D Pixar CGI-like and 2D anjmation, use 4 if you&#x27;re doing live action content. Using maximum at higher bitrates would just result in a blurry mess.</p></li><li><p><code>--disable-kf --enable-fwd-kf=0</code> We&#x27;re disabling keyframes cause <strong>Av1an already did scene detection, so we wont have to.</strong>. And it speeds things up.</p></li><li><p><code>--kf-max-dist=9999</code> Maximum keyframe interval, we&#x27;re setting it at the highest possible value since av1an&#x27;s scene detection keyframe interval is already 240 by default</p></li><li><p><code>--enable-chroma-deltaq=1 --enable-qm=1 --quant-b-adapt=1</code> Parameters that give you free efficiency boost, ignore it.</p></li><li><p><code>--enable-dnl-denoising=0</code> Disables the encoder&#x27;s built-in denoising technique when grain synthesis is enabled, you can optionally set it to 1 when you have a pretty noisy video since it works quite well</p></li><li><p><strong>OPTIONAL:</strong> <code>--denoise-noise-level=10</code> Alternative to <code>photon-noise</code>, slower than photon-noise and is the OG grain synthesis method, performs okay and just serves as an alternative. Don&#x27;t attempt to use it at high values (&gt;12) since it creates noticeable grain patterns.</p></li></ul><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Concatenation Error on Linux</div><div class="admonitionContent_S0QG"><p>Run <code>ulimit -n 200000</code>, resume, and it should concatenate just fine. If it still errors, head to the encode directory &gt; encode, and run <code>mkvmerge @../options.json</code></p></div></div><p><strong>Merging Everything</strong></p><p>Once you&#x27;re done just encode your audio using ffmpeg (or just passthrough it), subtitles should be carried along with your video output, and merge them in MKVToolNix! Don&#x27;t want Matroska files? That&#x27;s fine, you can use FFmpeg or MP4Box to output into .mp4, just keep in mind that PGS/SUP/VOBSUB subtitles are not supported and Opus audio support is highly experimental.</p><h1>Final Thoughts</h1><p>-&gt; Encoding has always been about experimentation for the best, there is really no &quot;One size fits all&quot; for encoding content, as they differ from scene complexity, how it&#x27;s captured (2D/Real life), film grain, dark scenes, etc. So experiment away for your specific type of content! &lt;-</p><blockquote><p><strong><em>Guide created by Simulping || simulping. on Discord and u/SimultaneousPing on Reddit.</em></strong></p></blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/av1-community-contributors/av1-wiki.github.io/tree/main/docs/guides/av1_for_dummies.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/av1-wiki.github.io/docs/metrics/ssimu2"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SSIMULACRA2</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/av1-wiki.github.io/docs/video-players"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">‚ñ∂Ô∏è Video Players</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#microsoft-windows" class="table-of-contents__link toc-highlight">Microsoft Windows</a></li><li><a href="#macos" class="table-of-contents__link toc-highlight">macOS</a></li><li><a href="#linux" class="table-of-contents__link toc-highlight">Linux</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Getting Started</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/av1-wiki.github.io/docs/prequisites">Prequisites</a></li><li class="footer__item"><a class="footer__link-item" href="/av1-wiki.github.io/docs/introduction/prologue">Prologue</a></li></ul></div><div class="col footer__col"><div class="footer__title">Filtering</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/av1-wiki.github.io/docs/filtering/Vapoursynth">Vapoursynth</a></li><li class="footer__item"><a class="footer__link-item" href="/av1-wiki.github.io/docs/filtering/deband">Deband</a></li><li class="footer__item"><a class="footer__link-item" href="/av1-wiki.github.io/docs/filtering/denoise">Denoise</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/av1-community-contributors/av1-wiki.github.io/tree/main" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contribute<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/av1-wiki.github.io/docs/terms-of-use">Terms of Use</a></li><li class="footer__item"><a href="https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2023 Gianni Rosato & contributors. Content licensed under CC BY-SA 4.0. Built with Docusaurus.</div></div></div></footer></div>
<script src="/av1-wiki.github.io/assets/js/runtime~main.5ff2ee5c.js"></script>
<script src="/av1-wiki.github.io/assets/js/main.fdbf91cc.js"></script>
</body>
</html>