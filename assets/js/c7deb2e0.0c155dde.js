"use strict";(self.webpackChunkcodec_wiki=self.webpackChunkcodec_wiki||[]).push([[9551],{2359:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"audio/WavPack","title":"WavPack","description":"This section is in need of contributions. If you believe you can help, please see our Contribution Guide to get started as a contributor!","source":"@site/docs/audio/WavPack.mdx","sourceDirName":"audio","slug":"/audio/WavPack","permalink":"/docs/audio/WavPack","draft":false,"unlisted":false,"editUrl":"https://github.com/av1-community-contributors/codec-wiki/tree/main/docs/audio/WavPack.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"title":"WavPack","sidebar_position":8},"sidebar":"tutorialSidebar","previous":{"title":"FLAC","permalink":"/docs/audio/FLAC"},"next":{"title":"AVC / H.264","permalink":"/docs/video/AVC"}}');var o=i(4848),r=i(8453);const a={title:"WavPack",sidebar_position:8},d="WavPack",t={},c=[{value:"Features",id:"features",level:2},{value:"Hybrid Mode",id:"hybrid-mode",level:2},{value:"Format Breakdown",id:"format-breakdown",level:2},{value:"Encoders",id:"encoders",level:2},{value:"wavpack",id:"wavpack-1",level:3},{value:"FFmpeg",id:"ffmpeg",level:3},{value:"Adoption issues",id:"adoption-issues",level:2},{value:"Notes",id:"notes",level:2}];function l(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(s.header,{children:(0,o.jsx)(s.h1,{id:"wavpack",children:"WavPack"})}),"\n",(0,o.jsx)(s.admonition,{title:"Help Wanted",type:"danger",children:(0,o.jsxs)(s.p,{children:["This section is in need of contributions. If you believe you can help, please see our ",(0,o.jsx)(s.a,{href:"/docs/contribution-guide",children:"Contribution Guide"})," to get started as a contributor!"]})}),"\n",(0,o.jsxs)(s.p,{children:["WavPack is an open-source lossless audio codec with support for lossless & lossy compression with a unique hybrid compression mode for compressing a lossy audio stream alongside a lossless reference. Created by David Bryant in 1998, it gained a lot of software support, although not as much as ",(0,o.jsx)(s.a,{href:"/docs/audio/FLAC",children:"FLAC"}),"."]}),"\n",(0,o.jsxs)(s.p,{children:["Compressed file size is somewhat between ",(0,o.jsx)(s.a,{href:"/docs/audio/FLAC",children:"FLAC"})," and heavier state-of-art lossless audio compressors like TAK, OptimFrog or SAC. Compared to ",(0,o.jsx)(s.a,{href:"/docs/audio/FLAC",children:"FLAC"}),", WavPack usually gives a lower bitrate at the expense of slightly more resource usage."]}),"\n",(0,o.jsx)(s.h2,{id:"features",children:"Features"}),"\n",(0,o.jsx)(s.p,{children:"WavPack is one of the most robust and feature-rich lossless audio codecs. Some notable features include:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"#hybrid-mode",children:"Hybrid mode"})}),"\n",(0,o.jsx)(s.li,{children:"Support for 1-32 bit integer/floating point audio streams"}),"\n",(0,o.jsxs)(s.li,{children:["Muxable into Matroska ",(0,o.jsx)(s.code,{children:".mkv"})," container"]}),"\n",(0,o.jsx)(s.li,{children:"Multichannel with up to 4096 channels"}),"\n",(0,o.jsx)(s.li,{children:"APEv2/ID3v1 tagging format"}),"\n",(0,o.jsx)(s.li,{children:"RIFF chunks support"}),"\n",(0,o.jsx)(s.li,{children:"Multithreaded encoding/decoding"}),"\n",(0,o.jsx)(s.li,{children:"Error detection using CRC32 checksums and optionally also MD5 hash of original audio data"}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"hybrid-mode",children:"Hybrid Mode"}),"\n",(0,o.jsxs)(s.p,{children:["Hybrid Mode is not to be confused with hybrid codecs like ",(0,o.jsx)(s.a,{href:"/docs/audio/Opus",children:"Opus"}),". WavPack uses the same algorithm for both lossy and lossless mode. When using lossy mode, the encoder transmits only the unary magnitude and the sign bit of Recursive Golomb encoded residuals. During decoding, those data points can be further enhanced if the correction file is provided."]}),"\n",(0,o.jsxs)(s.p,{children:["WavPack can produce 2 output files when using Hybrid Mode. The main ",(0,o.jsx)(s.code,{children:".wv"})," file with truncated (lossy) residuals and a ",(0,o.jsx)(s.code,{children:".wvc"})," correction file containing the enhancement layer. When both files are provided to the decoder, it should be able to recreate original audio data. Otherwise, if only the ",(0,o.jsx)(s.code,{children:".wv"})," file is available, the decoder will decode lossy audio stream."]}),"\n",(0,o.jsx)(s.h2,{id:"format-breakdown",children:"Format Breakdown"}),"\n",(0,o.jsxs)(s.p,{children:["Like in many lossless audio codecs, WavPack only encodes the prediction error value. In the default ",(0,o.jsx)(s.code,{children:"fast"})," mode, prediction is just extrapolation of the previous two samples. More sophisticated predictors are used with higher encoding modes.\nDue to poor performance, unpredictability, and other problems with floating-point arithmetic in CPUs of its time, WavPack only uses integer arithmetic even when operating on IEEE float data. Nowadays, many of those issues were addressed, however it could still make porting WavPack to chips with no FPU support much easier."]}),"\n",(0,o.jsx)(s.p,{children:"The encoding process consists of 3 main steps:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Joint stereo processing - Converts the stereo channels to the standard difference and average, removing inter-channel correlations."}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Multipass decorrelation - Includes multiple prediction passes where the number of passes and predictor type depend on the selected encoding mode, removing intra-channel correlations between neighboring audio samples."}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsx)(s.p,{children:"Entropy coding the residuals with Recursive Golomb Coding - Instead of Rice Coding, the author proposed a new technique that combines Golomb and Elias gamma code to better address the nature of audio data."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(s.h2,{id:"encoders",children:"Encoders"}),"\n",(0,o.jsx)(s.h3,{id:"wavpack-1",children:"wavpack"}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",metastring:'title="Default options"',children:"wavpack input.wav -o out.wv\n"})}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",metastring:'title="Fast, lowest compression, md5 hash"',children:"wavpack input.wav -f -m -o out.wv\n"})}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",metastring:'title="Very slow, highest compression, 8 threads"',children:"wavpack input.wav -hh -x6 --threads=8 -o out.wv\n"})}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",metastring:'title="Lossy, slow, 240kbps"',children:"wavpack input.wav -b240 -h -x3 -o out.lsy.wv\n"})}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",metastring:'title="Highest hybrid compression, very slow, 4bps"',children:"wavpack input.wav -b4 -cc -hh -x6 -o out.hyb.wv\n"})}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"wvunpack"})," can be used to decode resulting ",(0,o.jsx)(s.code,{children:".wv"})," files, however most major ",(0,o.jsx)(s.a,{href:"/docs/video-players",children:"media players"})," like MPV or VLC already have (limited) WavPack support."]}),"\n",(0,o.jsx)(s.p,{children:"Options:"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-f"})," Faster encode/decode at the expense of larger file size"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-h"})," Slower encode/decode with higher compression"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-hh"})," Slowest encode/decode with highest compression"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-x0"})," Disable extra filters"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-x3"})," Try all predefined filters, slow, higher compression"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-x6"})," Generate custom filters, very slow, best compression"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-b240"})," Enable lossy mode, set bitrate to ",(0,o.jsx)(s.code,{children:"240kbps"})," (acceptable range is ",(0,o.jsx)(s.code,{children:"24"}),"-",(0,o.jsx)(s.code,{children:"9600"})," but it won't get lower than ",(0,o.jsx)(s.code,{children:"2 bits per sample"}),")"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-b4"})," Enable lossy mode, set ",(0,o.jsx)(s.code,{children:"bits per sample"})," to ",(0,o.jsx)(s.code,{children:"4"})," (acceptable range is ",(0,o.jsx)(s.code,{children:"2"}),"-",(0,o.jsx)(s.code,{children:"23.9"}),")"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-c"})," Enable hybrid mode (will produce ",(0,o.jsx)(s.code,{children:".wv"})," and ",(0,o.jsx)(s.code,{children:".wvc"})," file)"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-cc"})," Enable and optimize for hybrid mode, might lower decoding speed and hurt quality"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"-m"})," Include MD5 hash of original audio data in the output file"]}),"\n"]}),"\n",(0,o.jsxs)(s.li,{children:["\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.code,{children:"--threads=8"})," Use ",(0,o.jsx)(s.code,{children:"8"})," threads (acceptable range is ",(0,o.jsx)(s.code,{children:"1"}),"-",(0,o.jsx)(s.code,{children:"12"}),")"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(s.p,{children:["For more detailed description of all available options, see the ",(0,o.jsx)(s.a,{href:"https://www.wavpack.com/wavpack_doc.html",children:"manual"}),"."]}),"\n",(0,o.jsx)(s.h3,{id:"ffmpeg",children:"FFmpeg"}),"\n",(0,o.jsxs)(s.p,{children:[(0,o.jsx)(s.a,{href:"/docs/utilities/ffmpeg",children:"FFmpeg"})," has its own native WavPack encoder and decoder. It used to also support ",(0,o.jsx)(s.code,{children:"libwavpack"})," with ",(0,o.jsx)(s.code,{children:"--enable-libwavpack"}),", however it was ",(0,o.jsx)(s.a,{href:"https://hydrogenaud.io/index.php/topic,120038.0.html",children:"removed"})," due to interface incompleteness."]}),"\n",(0,o.jsxs)(s.p,{children:["The native encoder is single-threaded and doesn't support neither Lossy or ",(0,o.jsx)(s.a,{href:"#hybrid-mode",children:"Hybrid"})," Mode. It uses the ",(0,o.jsx)(s.code,{children:"-compression_level"})," parameter to control speed to compression ratio."]}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",metastring:'title="Fastest, lowest compression"',children:"ffmpeg -i input.wav -compression_level 0 out.wv\n"})}),"\n",(0,o.jsx)(s.pre,{children:(0,o.jsx)(s.code,{className:"language-bash",metastring:'title="Slowest, highest compression"',children:"ffmpeg -i input.wav -compression_level 8 out.wv\n"})}),"\n",(0,o.jsxs)(s.p,{children:["For all possible parameters, consult the ",(0,o.jsx)(s.a,{href:"https://www.ffmpeg.org/ffmpeg-codecs.html#wavpack",children:"FFmpeg documentation"}),"."]}),"\n",(0,o.jsx)(s.h2,{id:"adoption-issues",children:"Adoption issues"}),"\n",(0,o.jsxs)(s.p,{children:["As of 2024, WavPack has been largely superseded by ",(0,o.jsx)(s.a,{href:"/docs/audio/FLAC",children:"FLAC"}),", which became the de facto standard for lossless audio on the Web and in Hardware."]}),"\n",(0,o.jsxs)(s.p,{children:["The implementation of WavPack in media software is often incomplete. FFmpeg doesn't support ",(0,o.jsx)(s.a,{href:"#hybrid-mode",children:"Hybrid Mode"}),", and other media players usually don't support it either. There are also ",(0,o.jsx)(s.a,{href:"https://www.reddit.com/r/ffmpeg/comments/tpptoi/using_hybrid_wavpack_in_video/",children:"issues"})," with its support in the ",(0,o.jsx)(s.code,{children:".mkv"})," container."]}),"\n",(0,o.jsxs)(s.p,{children:["Without this feature, WavPack doesn't provide much benefit over already widespread ",(0,o.jsx)(s.a,{href:"/docs/audio/FLAC",children:"FLAC"}),". The compressed file might be slightly smaller, however music streaming companies tend to choose well-standardized FLAC which also has the benefit of ",(0,o.jsx)(s.code,{children:"DRM"})," support in the ",(0,o.jsx)(s.code,{children:".mp4"})," container (apparently very important thing on the modern web)."]}),"\n",(0,o.jsxs)(s.p,{children:["Even if ",(0,o.jsx)(s.a,{href:"#hybrid-mode",children:"Hybrid Mode"})," had better software support, the minimum lossy setting is ",(0,o.jsx)(s.code,{children:"2 bits per sample"}),". That translates to around ",(0,o.jsx)(s.code,{children:"200kbps"})," with stereo audio track which is quite high. The quality of WavPack lossy mode is also somewhat lacking compared to modern lossy codecs such as ",(0,o.jsx)(s.a,{href:"/docs/audio/Opus",children:"Opus"})," or ",(0,o.jsx)(s.a,{href:"/docs/audio/AAC",children:"AAC"})," because it doesn't utilize any psychoacoustic model."]}),"\n",(0,o.jsx)(s.h2,{id:"notes",children:"Notes"}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsxs)(s.li,{children:["WavPack was one of the first compressed lossless audio codecs preceding Monkey's Audio (2000), ",(0,o.jsx)(s.a,{href:"/docs/audio/FLAC",children:"FLAC"})," (2001), OptimFROG (2002) and ",(0,o.jsx)(s.a,{href:"/docs/audio/ALAC",children:"ALAC"})," (2004)."]}),"\n",(0,o.jsx)(s.li,{children:"OptimFROG Dualstream is a feature of OptimFROG codec serving a similar purpose to WavPack Hybrid, however it was introduced much later."}),"\n",(0,o.jsxs)(s.li,{children:["Apparently there are some devices with WavPack ",(0,o.jsx)(s.a,{href:"https://hydrogenaud.io/index.php/topic,119143.0.html",children:"Hardware Support"}),"."]}),"\n"]}),"\n",(0,o.jsx)(s.p,{children:(0,o.jsx)(s.strong,{children:"References:"})}),"\n",(0,o.jsxs)(s.ul,{children:["\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://www.wavpack.com/WavPack.pdf",children:"WavPack Compression Techniques"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://www.wavpack.com/technical.htm",children:"WavPack Technical Document"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://web.archive.org/web/20160705230053/http://www.wavpack.com/file_format.txt",children:"Old WavPack File Format Specification"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://wiki.hydrogenaud.io/index.php?title=WavPack",children:"Hydrogenaudio Wiki"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://wiki.multimedia.cx/index.php/WavPack",children:"Multimedia.cx Wiki"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://en.wikipedia.org/wiki/WavPack",children:"Wikipedia"})}),"\n",(0,o.jsx)(s.li,{children:(0,o.jsx)(s.a,{href:"https://ffmpeg.org/doxygen/3.3/wavpackenc_8c_source.html",children:"FFmpeg WavPack Source"})}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,o.jsx)(s,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,s,i)=>{i.d(s,{R:()=>a,x:()=>d});var n=i(6540);const o={},r=n.createContext(o);function a(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);