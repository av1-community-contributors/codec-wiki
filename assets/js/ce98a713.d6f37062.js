"use strict";(self.webpackChunkcodec_wiki=self.webpackChunkcodec_wiki||[]).push([[6168],{5489:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"filtering/denoise","title":"Denoise","description":"This section is in need of contributions. If you believe you can help, please see our Contribution Guide to get started as a contributor!","source":"@site/docs/filtering/denoise.mdx","sourceDirName":"filtering","slug":"/filtering/denoise","permalink":"/docs/filtering/denoise","draft":false,"unlisted":false,"editUrl":"https://github.com/av1-community-contributors/codec-wiki/tree/main/docs/filtering/denoise.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"title":"Denoise","sidebar_position":8},"sidebar":"tutorialSidebar","previous":{"title":"Stabilizing","permalink":"/docs/filtering/stabilizing"},"next":{"title":"Dehalo","permalink":"/docs/filtering/dehalo"}}');var r=i(4848),t=i(8453);const o={title:"Denoise",sidebar_position:8},l="Denoise",d={},a=[{value:"Overview",id:"overview",level:2},{value:"hqdn3d",id:"hqdn3d",level:2},{value:"Usage",id:"usage",level:3},{value:"nlmeans",id:"nlmeans",level:2},{value:"Usage",id:"usage-1",level:3},{value:"Parameters",id:"parameters",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"denoise",children:"Denoise"})}),"\n",(0,r.jsx)(n.admonition,{title:"Help Wanted",type:"danger",children:(0,r.jsxs)(n.p,{children:["This section is in need of contributions. If you believe you can help, please see our ",(0,r.jsx)(n.a,{href:"/docs/contribution-guide",children:"Contribution Guide"})," to get started as a contributor!"]})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Denoising involves removing random noise from the video. Such noise can result from film grain, signal interference or simply low light conditions. In any case, noise can greatly reduce compression efficiency especially if the video codec doesn't support film grain synthesis."}),"\n",(0,r.jsxs)(n.p,{children:["In ",(0,r.jsx)(n.a,{href:"/docs/utilities/ffmpeg",children:"FFmpeg"})," there are two filters available for denoising:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#hqdn3d",children:"hqdn3d"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"#nlmeans",children:"nlmeans"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"hqdn3d",children:"hqdn3d"}),"\n",(0,r.jsx)(n.p,{children:"hqdn3d is a fast, high quality 3d denoising filter which improves compressibility. Can be applied to images and videos."}),"\n",(0,r.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"ffmpeg -i input.mp4 -vf hqdn3d output.mp4\n"})}),"\n",(0,r.jsx)(n.p,{children:"The default configuration should be fine for most use cases."}),"\n",(0,r.jsxs)(n.p,{children:["If you still see too much noise you can adjust the ",(0,r.jsx)(n.code,{children:"luma_spatial"})," parameter (other parameters are derived from it by default). Higher ",(0,r.jsx)(n.code,{children:"luma_spatial"})," value will result in stronger denoising. By default it is set to ",(0,r.jsx)(n.code,{children:"4"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"ffmpeg -i input.mp4 -vf hqdn3d=8 output.mp4\n# which is the same as\nffmpeg -i input.mp4 -vf hqdn3d=8:6:12:9 output.mp4\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["Setting ",(0,r.jsx)(n.code,{children:"luma_spatial"})," to larger values could result in ghosting and ",(0,r.jsx)(n.a,{href:"/docs/introduction/video-artifacts#bandingcontouring",children:"banding"})," artifacts."]})}),"\n",(0,r.jsxs)(n.p,{children:["For description of all four parameters take a look ",(0,r.jsx)(n.a,{href:"https://ffmpeg.org/ffmpeg-filters.html#hqdn3d-1",children:"here"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"nlmeans",children:"nlmeans"}),"\n",(0,r.jsxs)(n.p,{children:["nlmeans uses Non-Local Means algorithm to do denoising. Each pixel is compared to similar pixels based on their surroundings (context). The size of such context is expressed as ",(0,r.jsx)(n.code,{children:"r"}),"x",(0,r.jsx)(n.code,{children:"r"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The filter is rather slow and doesn't parallelize well. Only use it in cases the video contains a lot of noise or you need very high quality denoising. In all other cases ",(0,r.jsx)(n.a,{href:"#hqdn3d",children:"hqdn3d"})," will be more efficient."]}),"\n",(0,r.jsx)(n.h3,{id:"usage-1",children:"Usage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ffmpeg -i input.mp4 -vf nlmeans output.mp4\n"})}),"\n",(0,r.jsx)(n.p,{children:"The default configuration should be fine for most use cases."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ffmpeg -i input.mp4 -vf nlmeans=s=3.0:r=31:p=15 output.mp4\n"})}),"\n",(0,r.jsx)(n.p,{children:"Stronger denoising with larger research and patch size. Might be useful for ultra high quality denoising in 4K+ resolutions but you might struggle to achieve even 0.1 fps."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ffmpeg -i input.mp4 -vf nlmeans=s=1.0:r=5:p=3 output.mp4\n"})}),"\n",(0,r.jsx)(n.p,{children:"Prioritize speed over quality."}),"\n",(0,r.jsx)(n.h3,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"s"})," - Denoising Strength where ",(0,r.jsx)(n.code,{children:"1.0"})," is the lightest and also the default and the strongest is ",(0,r.jsx)(n.code,{children:"30.0"})," although I wouldn't recommend going above ",(0,r.jsx)(n.code,{children:"10.0"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"r"})," - Research Size where ",(0,r.jsx)(n.code,{children:"15"})," is the default, it must be an odd number ranging from ",(0,r.jsx)(n.code,{children:"0"})," to ",(0,r.jsx)(n.code,{children:"99"}),". The higher the value, the slower denoising will be."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"p"})," - Research Size where ",(0,r.jsx)(n.code,{children:"7"})," is the default and, it must be an odd number ranging from ",(0,r.jsx)(n.code,{children:"0"})," to ",(0,r.jsx)(n.code,{children:"99"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For description of all possible parameters take a look ",(0,r.jsx)(n.a,{href:"https://ffmpeg.org/ffmpeg-filters.html#nlmeans-1",children:"here"}),"."]}),"\n",(0,r.jsx)(n.h1,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#hqdn3d",children:"hqdn3d"})," may create visual artifacts like ghosting, ",(0,r.jsx)(n.a,{href:"/docs/introduction/video-artifacts#bandingcontouring",children:"banding"})," and ",(0,r.jsx)(n.a,{href:"/docs/introduction/video-artifacts#blocking",children:"blocking"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"#nlmeans",children:"nlmeans"})," creates much less noticeable artifacts like cartoonish look but only for very noisy inputs"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var s=i(6540);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);